# Service

발표자 : 송시은

발표일자 : 

발표주제 : Service

------



## 0. 참고 문서

- 될 때까지 안드로이드(오준석 지음)
- https://developer.android.com/guide/components/services?hl=ko



## 1. 개요

**서비스:** 백그라운드에서 오래 실행되는 작업을 수행할 수 있는 애플리케이션 구성 요소 

- 서비스는 이름 그대로 다른 컴포넌트에게 서비스를 제공하려는 목적으로 사용

- 오래 걸리는 작업을 백그라운드에서 실행하게 하고, 눈에 보이는 화면을 가지지 않는다.

  - ex) 파일 다운로드, 음악 재생

- [BadThreadExam]: https://github.com/taeiim/Android-Study/tree/master/study/week14/Service/BadThreadExam

- 서비스 컴포넌트를 사용하면 위 예제와 같은 문제를 해결할 수 있다!



## 2. 서비스 사용하기

서비스는 스타트 서비스와 바인드 서비스, 두 가지 방식을 제공

두 가지 중 선택하여 사용할 수도 있고, 둘 다 사용할 수도 있다.

- **스타트 서비스** 
  - 시작해 두면 완전히 독립적으로 수행되는 작업을 한다.
  - 다른 컴포넌트가 중간에 종료시킬 수 있다.
- **바인드 서비스** 
  - 서비스와 다른 컴포넌트와 연결고리를 만든다. 
  - 따라서 연결된 컴포넌트의 상태에 따라 서비스의 동작을 제어할 수 있다. 
  - 독립적이지 않고 다른 컴포넌트에 의존한다.



### 2.1. 스타트 서비스

스타트 서비스는 파일 다운로드, 음악 재생과 같은 기능을 구현할 때 사용(물론 도중에 종료 가능)

앱을 종료했다가 다시 시작하더라도 서비스는 계속 동작하여 다운로드 작업을 멈추지 말아야 한다.

[StartService]: https://github.com/taeiim/Android-Study/tree/master/study/week14/Service/ServiceExam

=> 서비스는 액티비티와 독립적으로 동작하므로 앱을 종료하고 다시 실행헤도 서비스의 생명주기에는 아무 영향이 없다.



##### Q. 서비스와 스레드 중 어느 것을 사용해야 할까?

A. 서비스는 필요할 때만 생성하는 게 좋다. 

- 백그라운드에서 수행하지만 사용자가 앱을 사용 중일 때만 동작해야 하는 상황에는 서비스 대신 스레드! 
- 서비스를 사용할 때 주의할 점으로는 모든 컴포넌트는 메인 스레드에서 동작하므로 서비스가 수행하는 작업이 메인 스레드를 점유하는 일이라면 UI를 차단하지 않도록 서비스 내에서 스레드를 생성하야 한다는 점



##### 서비스의 생존을 결정하는 법

안드로이드 시스템은 자원이 부족하면 백그라운드에서 실행되는 프로세스를 하나씩 강제로 종료하므로 서비스 역시 강제 종료 대상이 될 수 있다!

onStartCommand() 메서드가 반환하는 상수가 그런 역할을 한다. 강제 종료된 서비스를 살릴 수 있는 다양한 옵션

| 상수                   | 의미                                                         |
| ---------------------- | ------------------------------------------------------------ |
| START_NOT_STICKY       | 전달할 인텐트가 있을 때를 제외하고, 서비스가 중단되면 재생성하지 않는다. 가장 일반적인 옵션 |
| START_STICKY           | 서비스가 중단되면 서비스를 재시작하지만, 인텐트는 다시 전달하지 않는다. 미디어 플레이어와 같이 서비스가 무기한으로 동작해야 할 때 적합 |
| START_REDELIVER_INTENT | START_STICKY와 다르게,  인텐트와 함께 서비스를 재시작한다. 파일 다운로드와 같이 무엇을 다운로드 했었는지 알아야 할 때 적합 |



##### 서비스에서 스레드를 사용하는 이유

서비스를 포함한 안드로이드 4대 컴포넌트는 메인 스레드에서 실행되므로 오래 걸리는 처리를 하게 되면 화면이 버벅대면서 ANR이 발생할 수 있다. ANR 발생을 막으려면 서비스 내에서 스레드를 생성해야 한다.



##### 서비스의 종료

서비스의 종료는 액티비티와 같은 컴포넌트에서 stopService() 메서드를 사용하였는데, 서비스 내에서 stopSelf() 메서드를 사용해도 된다.



### 2.2 인텐트 서비스

대부분의 서비스는 여러 요펑을 동시에 처리하지 않아도 되기 때문에, 일반적으로 Service를 확장한 IntentService 클래스를 사용한다. 이 클래스는 기본 Service 클래스와 비교하여 다음과 같은 작업을 수행한다.

- onStartCommand() 메서드에 전달된 인텐트마다 별도의 스레드를 자동으로 생성해 준다.
- 한 번에 하나의 인텐트를 처리하는 onHandleIntent() 메서드를 제공한다.
- 모든 수행이 끝나면 자동으로 stopSelf() 메서드를 호출하여 종료된다.

가장 큰 특징은 인텐트 서비스는 기본적으로 작업 스레드에서 동작하므로 일반 서비스보다 코드를 간결하게 작성!!



#### 2.2.1. 같이 실습~

1. MyIntentService 클래스 생성
2. 생성자, onHandleIntent() 메서드만 남기고 나머지 코드 제거(인텐트 서비스 기본적인 사용방법을 알기 위해)
3. onHandleIntent() 메서드(작업 스레드로 동작하므로)에 오래 걸리는 처리를 작성
4. xml에 인텐트 서비스 시작 버튼 작성
5. 메인 액티비티에 인텐트 서비스를 시작하는 코드 추가