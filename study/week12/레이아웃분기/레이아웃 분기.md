# flexible UI

> 발표자 : 송시은
>
> 발표주제 : 레이아웃 분기
>
> 발표일자 : 2018-09-07



## 0. 참고문서

- 될 때까지 안드로이드(오준석 지음)
- https://developer.android.com/training/basics/fragments/fragment-ui?hl=ko
- https://developer.android.com/training/basics/fragments/communicating?hl=ko



## 1. 리소스 분기

안드로이드 프로젝트에서 아이콘이 있는 mipmap 디렉터리는 기기의 밀도(density)에 따라 분기하도록 되어있다. 앱이 실행될 때 기기의 밀도에 따라 해당 폴더의 아이콘이 선택되는 것이다.

![](https://github.com/taeiim/Android-Study/blob/master/study/week12/%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83%EB%B6%84%EA%B8%B0/mipmap.PNG)



레이아웃도 이런식으로 분기하도록 처리할 수 있다.



## 2. 레이아웃 분기

### 2.1. 실습

1. 레이아웃 분기를 위해 res 디렉터리에서 마우스 오른쪽을 누르고 [New -> Android resource directory]를 클릭하여 리소스 디렉터리를 추가한다
2. New Resource Directory 창에서 Resource type:은 'layout'을 선택하고, 왼쪽 하단에 Available qualifiers 상자에서 'Orientation'을 선택한 다음, 가운데에 있는 >> 버튼을 누른다.
3. Screen orientation: 항목에서 'Landscape'를 선택한다. 그러면 Directory name:이 layout-land로 설정되며, 이 디렉터리에 있는 레이아웃 XML은 가로 모드에 우선으로 적용되는 레이아웃이 된다.
4. layout/activity_main.xml 파일을 layout-land 디렉터리에 복사해서 붙여넣는다.
5. 가로 모드와 세로 모드의 레이아웃을 설정한다.

레이아웃 분기를 프래그 먼트와 조합하면 다양한 화면 구성을 보다 쉽게 구성할 수 있다.



## 3. 유연한 사용자 인터페이스 구축 

프래그먼트를 사용하면 다양한 화면 크기를 지원하는 앱을 만들 때, 화면 크기나 방향에 따라 프래그먼트를 재활용하여 레이아웃을 구성할 수 있다. 이는 태플릿과 핸드폰을 동시에 지원하는 앱을 개발할 때 유용하다.

예시)

![](https://github.com/taeiim/Android-Study/blob/master/study/week12/%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83%EB%B6%84%EA%B8%B0/fragments-screen-mock.png)



**FragmentManager 클래스** 런타임에 동적으로 프래그먼트를 추가나 삭제, 또는 교체할 수 있는 메서드를 제공



### 3.1. 실습

작성할 예제의 동작을 그림으로 표현하면 다음과 같다.

![](https://github.com/taeiim/Android-Study/blob/master/study/week12/%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83%EB%B6%84%EA%B8%B0/example_process_pic.PNG)

1. 액티비티가 시작하면 HeadlinesFragment를 동적 추가한다.
2. HeadlinesFragment에서 아이템이 선택되면 onHeadlineSelected 콜백이 호출된다.
3. 액티비티에서 ArticleFragment로 프래그먼트를 교체한다.
4. 프래그먼트가 교체되기 전에 백스택에 저장함으로써 뒤로 가기로 HeadlinesFragment로 돌아갈 수 있다.

------

제목을 누르면 내용을 표시하는 간단한 앱의 샘플을 작성할 것이다.

프래그먼트 A에 제목 리스트가 표시되게 하고, 제목을 클릭하면 프래그먼트 B에 내용이 보이게 할 것이다.

이를 위해 Article 클래스를 새로 만들고 다음과 같은 코드를 작성한다.

```java
public class Articles {
    // 제목
    static String[] Headlines = {
            "제목 1", "제목 2"
    };
    // 내용
    static String[] Articles = {
            "이것은 제목1의 내용입니다.",
            "이것은 제목2의 내용입니다."
    };
}
```



#### 3.1.1. 화면이 작은 기기에서의 동작

화면이 작은 기기와 큰 기기(7인치 이상 태블릿)에서 레이아웃과 앱의 동작이 다르게 하려고 한다.

핸드폰처럼 화면 크기가 7인치 미만인 기기에서는 프래그먼트 A의 리스트를 클릭하면 프래그먼트 B의 내용이 표시되게 하고, 태블릿처럼 큰 기기에서는 한 화면에 프래그먼트 A와 B가 결합되어 리스트와 내용이 모두 표시되게 하려고 한다. 



1. 프래그먼트 A에 해당하는 HeadlinesFragment를 작성한다 - 제목을 표시하는 리스트를 표시

   ```java
   /**
    * 제목을 표시할 리스트 프래그먼트
    */
   public class HeadlinesFragment extends ListFragment {
       // 이 프래그먼트를 포함하는 액티비티는 반드시 이 인터페이스를 구현해야 함
       interface OnHeadlineSelectedListener {
           // 제목이 선택되었을 때 호출됨
           void onHeadlineSelected(int position);
       }
       private OnHeadlineSelectedListener mListener;
       @Override
       public void onCreate(@Nullable Bundle savedInstanceState){
           super.onCreate(savedInstanceState);
           // Articles 의 Headlines 배열을 사용하여 리스트 뷰를 위한 ArrayAdapter 를 생성
           setListAdapter(new ArrayAdapter<String>(getActivity(), android.R.layout.simple_list_item_1, Articles.Headlines));
       }
       @Override
       public void onAttach(Context context) {
           super.onAttach(context);
           // 이 프래그먼트를 포함하는 Context 는 반드시 OnHeadlineSelectedListener 를 구현해야 한다.
           // 그렇지 않으면 ClassCastException 이 발생하고 앱을 종료한다.
           try {
               mListener = (OnHeadlineSelectedListener) context;
           }catch (ClassCastException e){
               throw new ClassCastException(context.toString() + " must implement OnHeadlineSelectedListener");
           }
       }
       @Override
       public void onListItemClick(ListView l, View v, int position, long id){
           super.onListItemClick(l, v, position, id);
           // 선택된 위치를 액티비티에 알려 줌
           if (mListener != null) {
               mListener.onHeadlineSelected(position);
           }
       }
   }
   ```

   이 프래그먼트는 ListFragment를 상속하며 제목의 리스트를 표시하고 제목을 클릭했을 때 이 프래그먼트를 포함하고 있는 액티비티에 콜백을 호출하도록 되어있다. 이 프래그먼트를 포함할 액티비티는 반드시 OnHeadlineSelectedListener 인터페이스를 구현하도록 onAttach() 메서드에서 강제로 액티비티와 연결하고 있다.



2. 프래그먼트의 레이아웃 파일을 준비 `fragment_article`

   ```xml
   <?xml version="1.0" encoding="utf-8"?>
   <LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
   android:layout_width="match_parent"
   android:layout_height="match_parent"
   android:orientation="vertical">
   
   <TextView
       android:id="@+id/article_text"
       android:layout_width="wrap_content"
       android:layout_height="wrap_content" />
   </LinearLayout>
   ```

   

3. 프래그먼트 B에 해당하는 ArticleFragment 프래그먼트를 작성한다 - 내용을 텍스트뷰에 표시

   ```java
   /**
    * HeadlinesFragment 를 클릭했을 때 기사를 표시할 프래그먼트
    */
   
   public class ArticleFragment extends Fragment {
       public static final String ARG_POSITION = "position";
       private int mCurrentPosition = -1;
   
       @Nullable
       @Override
       public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
           // 화면이 회전되면 이전에 선택된 위치를 복원
           if (savedInstanceState != null) {
               mCurrentPosition = savedInstanceState.getInt(ARG_POSITION);
           }
           // 화면 레이아웃은 TextView 하나만 있는 레이아웃을 사용
           return inflater.inflate(R.layout.fragment_articles, container, false);
       }
   
       @Override
       public void onActivityCreated(@Nullable Bundle savedInstanceState) {
           super.onActivityCreated(savedInstanceState);
           Bundle args = getArguments();
           if (args != null) {
               // 프래그먼트가 생성되었을 경우
               updateArticleView(args.getInt(ARG_POSITION));
           } else if (mCurrentPosition != -1) {
               // 화면 회전 등의 경우
               updateArticleView(mCurrentPosition);
           }
       }
   
       // 선택된 기사를 표시
       public void updateArticleView(int position) {
           TextView article = (TextView) getView().findViewById(R.id.article_text);
           article.setText(Articles.Articles[position]);
           mCurrentPosition = position;
       }
   
       @Override
       public void onSaveInstanceState(Bundle outState) {
           super.onSaveInstanceState(outState);
           // 화면이 회전될 때, 선택된 위치를 저장
           outState.putInt(ARG_POSITION, mCurrentPosition);
       }
   }
   ```

   이 프래그먼트는 몇 번째 제목이 선택되었는지에 따라서 해당 제목의 내용을 Articles.Articles 배열에서 가져와서 텍스트뷰에 표시한다. 프래그먼트는 액티비티 생명주기와 연관된 복잡한 사정으로 생성자를 통한 파라미터 전달이 금지되어 있다고 했다. 파ㅏ미터를 가지는 생성자를 만들면 안드로이드 스튜디오가 빨간 줄로 표시할 것이다. 대신 Bundle 객체를 Argument로 전달할 수 있다.

